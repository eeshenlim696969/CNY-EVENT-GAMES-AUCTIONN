<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Controller</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Playfair+Display:ital@0;1&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body { font-family: 'Playfair Display', serif; background: #2a0000; background-image: url('https://www.transparenttextures.com/patterns/black-scales.png'); color: #FFD700; touch-action: manipulation; }
Â  Â  Â  Â  .font-imp { font-family: 'Cinzel', serif; }
Â  Â  Â  Â  .glass-panel { background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255,215,0,0.2); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
Â  Â  Â  Â  .btn-gold { background: linear-gradient(180deg, #FFD700, #B8860B); color: #2a0000; border: 1px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.5); font-weight: 900; }
Â  Â  Â  Â  .btn-gold:active { transform: scale(0.95); }
Â  Â  Â  Â  .profile-header { background: linear-gradient(180deg, #1a0000 0%, #000000 100%); border-bottom: 2px solid #C5A059; }
Â  Â  Â  Â  .btn-seal { background: linear-gradient(180deg, #00ff00, #006600); color: white; box-shadow: 0 0 20px #00ff00; animation: pulse-green 2s infinite; }
Â  Â  Â  Â  @keyframes pulse-green { 0% { box-shadow: 0 0 10px #00ff00; } 50% { box-shadow: 0 0 30px #00ff00; } 100% { box-shadow: 0 0 10px #00ff00; } }
Â  Â  </style>
</head>
<body class="h-[100dvh] flex flex-col">

Â  Â  <div id="login" class="absolute inset-0 z-50 bg-[#1a0000] flex flex-col items-center justify-center p-8">
Â  Â  Â  Â  <h1 class="font-imp text-4xl mb-4 text-[#FFD700]">IMPERIAL<br>COURT</h1>
Â  Â  Â  Â  <input id="inp-name" class="w-full glass-panel p-4 text-center rounded text-xl" placeholder="Dynasty Name">
Â  Â  Â  Â  <button onclick="login()" class="mt-4 btn-gold w-full py-4 text-xl rounded shadow-[0_0_20px_gold]">ENTER</button>
Â  Â  </div>

Â  Â  <div id="view-bankrupt" class="hidden absolute inset-0 z-40 bg-black flex flex-col items-center justify-center text-center p-8">
Â  Â  Â  Â  <div class="text-6xl mb-4">â˜ ï¸</div>
Â  Â  Â  Â  <h1 class="font-imp text-4xl text-red-600 mb-2">DYNASTY FALLEN</h1>
Â  Â  Â  Â  <p class="text-gray-400">Your treasury is empty.</p>
Â  Â  </div>

Â  Â  <div id="app" class="hidden flex-col h-full relative">
Â  Â  Â  Â  <div class="h-20 flex justify-between items-center px-4 profile-header shrink-0 shadow-lg">
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-10 h-10 rounded-full bg-black border border-[#C5A059] flex items-center justify-center text-xl"><span id="rank-icon">âš”ï¸</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col"><span id="name-display" class="font-bold text-white text-lg leading-none">Player</span><span id="rank-display" class="text-xs text-[#C5A059] uppercase tracking-widest">Soldier</span></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="text-right"><div class="text-[9px] text-[#C5A059] uppercase">Treasury</div><div class="font-imp font-bold text-xl text-white">RM <span id="balance" class="text-[#FFD700]">--</span></div></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="spy-banner" class="hidden bg-[#000] border-y border-red-500 p-2 text-center shadow-lg">
Â  Â  Â  Â  Â  Â  <span class="text-red-500 text-xs font-bold uppercase tracking-widest mr-2 animate-pulse">ğŸ•µï¸ INTEL REPORT:</span>
Â  Â  Â  Â  Â  Â  <span id="spy-text" class="text-white font-bold">--</span>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="flex-1 p-4 flex flex-col justify-center relative overflow-hidden">
Â  Â  Â  Â  Â  Â  <div id="view-bidding" class="hidden flex-col gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="glass-panel p-4 rounded text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[#C5A059] text-xs uppercase tracking-widest">Current High Bid</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-5xl font-imp font-black text-white drop-shadow-md">RM <span id="high-bid">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-4 gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="quick(0.1)" class="glass-panel py-3 rounded text-xs hover:bg-[#FFD700] hover:text-black transition">+10%</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="quick(0.25)" class="glass-panel py-3 rounded text-xs hover:bg-[#FFD700] hover:text-black transition">+25%</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="quick(0.5)" class="glass-panel py-3 rounded text-xs hover:bg-[#FFD700] hover:text-black transition">+50%</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="quick(1)" class="glass-panel py-3 rounded text-xs text-red-400 border-red-900 hover:bg-red-600 hover:text-white transition">ALL</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-[#C5A059]">RM</span><input type="number" id="bid-val" class="w-full glass-panel p-4 pl-12 text-3xl font-bold rounded text-center" placeholder="0"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="submit()" id="btn-bid" class="btn-gold py-5 text-2xl rounded shadow-lg tracking-widest mt-2">OFFER TRIBUTE</button>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="feedback" class="text-center text-red-300 h-6 text-sm font-bold tracking-wide mt-2"></div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="view-wager" class="hidden flex-col items-center gap-6 glass-panel p-6 rounded">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center"><div class="text-6xl mb-2">ğŸ²</div><h2 class="text-2xl font-imp text-[#FFD700]">HIGH ROLLER</h2><p class="text-sm text-gray-300">Double or Nothing?</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="wager-val" class="w-full glass-panel p-4 text-3xl font-bold rounded text-center" placeholder="Amount">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="submitWager()" class="btn-gold w-full py-4 text-xl rounded">LOCK IN WAGER</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="view-idle" class="hidden text-center opacity-70">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="animate-pulse text-6xl mb-4">ğŸ</div><h2 class="font-imp text-2xl text-white" id="idle-msg">WAITING...</h2>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="seal-indicator" class="hidden absolute bottom-6 right-6 w-16 h-16 rounded-full text-2xl z-50 flex items-center justify-center border-2 border-white bg-green-700 shadow-[0_0_20px_green]">ğŸ›¡ï¸</div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
Â  Â  Â  Â  import { getDatabase, ref, onValue, get, set, update, push, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDdUHww7xef3DzLgSj5ZblQkTSu861jGQM",
Â  Â  Â  Â  Â  Â  authDomain: "auction-ebc97.firebaseapp.com",
Â  Â  Â  Â  Â  Â  databaseURL: "https://auction-ebc97-default-rtdb.asia-southeast1.firebasedatabase.app",
Â  Â  Â  Â  Â  Â  projectId: "auction-ebc97",
Â  Â  Â  Â  Â  Â  storageBucket: "auction-ebc97.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "883038465804",
Â  Â  Â  Â  Â  Â  appId: "1:883038465804:web:df2595623ca5276561a329",
Â  Â  Â  Â  Â  Â  measurementId: "G-69HD10GML7"
Â  Â  Â  Â  };

Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getDatabase(app);
Â  Â  Â  Â  let myId = localStorage.getItem('id'), myName = localStorage.getItem('name'), balance = 1000, highBid = 0, myCurrentBid = 0;
Â  Â  Â  Â  let isSpinning = false;Â 

Â  Â  Â  Â  // UPDATED CARD LIST
Â  Â  Â  Â  const cardNames = {
Â  Â  Â  Â  Â  Â  1: "Magic Bowl (+5k)", 2: "Market Crash (-20%)", 3: "Tax (Steal 30%)",
Â  Â  Â  Â  Â  Â  4: "Duel (Steal 20%)", 5: "Golden Horse (x3)", 6: "Bandits (-10%)",
Â  Â  Â  Â  Â  Â  7: "Imperial Grant (+8k)", 8: "Blockade", 9: "Robin Hood (Steal 15%)",
Â  Â  Â  Â  Â  Â  10: "Broken Vase (-5%)", 11: "Interest (+50%)", 12: "God of Wealth (+18k)",
Â  Â  Â  Â  Â  Â  13: "Bad Omen (-25%)", 14: "Twin Carp", 15: "Nian Monster (-50%)",
Â  Â  Â  Â  Â  Â  16: "Spy (Item)", 17: "Phoenix", 18: "False Friend", 19: "Shared Bill (-10%)",
Â  Â  Â  Â  Â  Â  20: "Jade Seal (Auto-Block)", 21: "Mystery Box (Spin)", 22: "Bad Luck (-15%)",
Â  Â  Â  Â  Â  Â  23: "Chaos Swap", 24: "Lucky Song (+6k)", 25: "High Roller (Gamble)"
Â  Â  Â  Â  };

Â  Â  Â  Â  if(myId) init();

Â  Â  Â  Â  window.login = async () => {
Â  Â  Â  Â  Â  Â  const n = document.getElementById('inp-name').value;
Â  Â  Â  Â  Â  Â  if(!n) return;
Â  Â  Â  Â  Â  Â  const id = n.toLowerCase().replace(/[^a-z0-9]/g, '');
Â  Â  Â  Â  Â  Â  const r = ref(db, teams/${id});
Â  Â  Â  Â  Â  Â  const s = await get(r);
Â  Â  Â  Â  Â  Â  if(s.exists()) { alert("NAME TAKEN! Choose another."); return; }
Â  Â  Â  Â  Â  Â  await set(r, { name: n, balance: 1000 });
Â  Â  Â  Â  Â  Â  localStorage.setItem('id', id); localStorage.setItem('name', n);
Â  Â  Â  Â  Â  Â  myId = id; myName = n;
Â  Â  Â  Â  Â  Â  init();
Â  Â  Â  Â  }

Â  Â  Â  Â  function init() {
Â  Â  Â  Â  Â  Â  document.getElementById('login').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('app').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('app').classList.add('flex');
Â  Â  Â  Â  Â  Â  document.getElementById('name-display').innerText = myName;

Â  Â  Â  Â  Â  Â  onValue(ref(db, teams/${myId}), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const t = snap.val();
Â  Â  Â  Â  Â  Â  Â  Â  if(!t) return;
Â  Â  Â  Â  Â  Â  Â  Â  balance = t.balance;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('balance').innerText = balance.toLocaleString();
Â  Â  Â  Â  Â  Â  Â  Â  checkAlive();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Show Shield Icon if protected
Â  Â  Â  Â  Â  Â  Â  Â  const hasSeal = t.items && t.items.jade_seal;
Â  Â  Â  Â  Â  Â  Â  Â  if(hasSeal) document.getElementById('seal-indicator').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  else document.getElementById('seal-indicator').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // SPY LOGIC: Only show if 'spy_active' is true
Â  Â  Â  Â  Â  Â  Â  Â  window.hasSpy = t.items && t.items.spy_active;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  onValue(ref(db, 'gameState'), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const st = snap.val();
Â  Â  Â  Â  Â  Â  Â  Â  if(!st) return;
Â  Â  Â  Â  Â  Â  Â  Â  highBid = st.highestBid || 0;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('high-bid').innerText = highBid.toLocaleString();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(st.leaderId === myId) myCurrentBid = highBid; else myCurrentBid = 0;
Â  Â  Â  Â  Â  Â  Â  Â  checkAlive();
Â  Â  Â  Â  Â  Â  Â  Â  updateView(st);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  onValue(ref(db, 'teams'), (snap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const teams = snap.val();
Â  Â  Â  Â  Â  Â  Â  Â  const sorted = Object.keys(teams).sort((a,b) => teams[b].balance - teams[a].balance);
Â  Â  Â  Â  Â  Â  Â  Â  const rank = sorted.indexOf(myId) + 1;
Â  Â  Â  Â  Â  Â  Â  Â  const rText = document.getElementById('rank-display');
Â  Â  Â  Â  Â  Â  Â  Â  if(rank === 1) { rText.innerText = "EMPEROR"; rText.style.color = "#FFD700"; }
Â  Â  Â  Â  Â  Â  Â  Â  else if(rank === 2) { rText.innerText = "WARLORD"; rText.style.color = "#C0C0C0"; }
Â  Â  Â  Â  Â  Â  Â  Â  else { rText.innerText = RANK #${rank}; rText.style.color = "#C5A059"; }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkAlive() {
Â  Â  Â  Â  Â  Â  const netWorth = balance + myCurrentBid;
Â  Â  Â  Â  Â  Â  if(netWorth <= 0 && !isSpinning) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-bankrupt').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-bankrupt').classList.add('flex');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-bankrupt').classList.add('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateView(st) {
Â  Â  Â  Â  Â  Â  ['view-bidding', 'view-wager', 'view-idle'].forEach(i => {
Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(i);
Â  Â  Â  Â  Â  Â  Â  Â  if(el) { el.classList.add('hidden'); el.classList.remove('flex'); }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  document.getElementById('spy-banner').classList.add('hidden');

Â  Â  Â  Â  Â  Â  if (st.phase === 'BIDDING') {
Â  Â  Â  Â  Â  Â  Â  Â  isSpinning = false;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-bidding').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-bidding').classList.add('flex');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('bid-val').placeholder = Min: ${highBid+50};
Â  Â  Â  Â  Â  Â  Â  Â  if(window.hasSpy && st.currentCard) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('spy-banner').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cName = cardNames[st.currentCard] || Mystery Card #${st.currentCard};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('spy-text').innerText = cName;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (st.phase === 'WAGER' && st.wagerTeam === myId) {
Â  Â  Â  Â  Â  Â  Â  Â  isSpinning = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-wager').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-wager').classList.add('flex');
Â  Â  Â  Â  Â  Â  } else if (st.phase === 'READY_TO_SPIN' || st.phase === 'SPIN') {
Â  Â  Â  Â  Â  Â  Â  Â  isSpinning = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-idle').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('idle-msg').innerText = "WATCH THE SCREEN...";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  isSpinning = false;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('view-idle').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  if(st.phase === 'SOLD') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('idle-msg').innerText = (st.leaderId === myId) ? "VICTORY" : "SOLD";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('idle-msg').innerText = "WAITING...";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  checkAlive();
Â  Â  Â  Â  }

Â  Â  Â  Â  window.quick = (p) => {
Â  Â  Â  Â  Â  Â  const totalPower = balance + myCurrentBid;
Â  Â  Â  Â  Â  Â  document.getElementById('bid-val').value = Math.floor(totalPower * p);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.submit = async () => {
Â  Â  Â  Â  Â  Â  const v = parseInt(document.getElementById('bid-val').value);
Â  Â  Â  Â  Â  Â  if(isNaN(v)) return;
Â  Â  Â  Â  Â  Â  const cost = v - myCurrentBid;
Â  Â  Â  Â  Â  Â  if(cost > balance) return feedback("Low Funds");
Â  Â  Â  Â  Â  Â  if(v < highBid + 50) return feedback("Too Low");
Â  Â  Â  Â  Â  Â  const b = document.getElementById('btn-bid');
Â  Â  Â  Â  Â  Â  b.disabled = true; b.innerText = "...";
Â  Â  Â  Â  Â  Â  await push(ref(db, 'bidQueue'), { teamId: myId, amount: v });
Â  Â  Â  Â  Â  Â  setTimeout(() => { b.disabled = false; b.innerText = "OFFER TRIBUTE"; }, 1000);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.submitWager = async () => {
Â  Â  Â  Â  Â  Â  Â const v = parseInt(document.getElementById('wager-val').value);
Â  Â  Â  Â  Â  Â  Â if(!v || v > balance) return;
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â const isWin = Math.random() > 0.5;
Â  Â  Â  Â  Â  Â  Â const result = isWin ? 'WIN' : 'LOSE';
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â await update(ref(db, 'gameState'), { phase: 'READY_TO_SPIN', spinResult: result, wagerAmount: v });
Â  Â  Â  Â  };

Â  Â  Â  Â  function feedback(t) { document.getElementById('feedback').innerText = t; }
Â  Â  </script>
</body>
</html>
